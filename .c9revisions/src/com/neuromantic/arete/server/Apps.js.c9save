{"ts":1357160215132,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"/*!\n *\n * Apps.js\n * com.neuromantic.arete.Apps\n *\n */\n_package( 'com.neuromantic.arete.server',\n \t_import( 'com.neuromantic.arete.component.Component' ),\n\t_class( 'Apps' )._extends( 'Component', {\n\t\tApps : function( ) {\n\t\t},\n\t\tprocess : function ( message ) {\n\t\t\tvar url = require( 'url' );\n\t\t\tvar fs = require( 'fs');\n\t\t\tvar path = require( 'path');\n\t\t\tif( message.request ) {\n\t\t\t\tvar route = url.parse( message.request.req.url, true )\n\t\t\t\tvar loc = route.path;\n\t\t\t\tif( loc.indexOf('/') === 0 ){\n\t\t\t\t\tloc = loc.substring(1);\n\t\t\t\t}//if\n\t\t\t\tvar classPath;\n\t\t\t\tif ( loc.indexOf( 'app' ) === 0 ){\n\t\t\t\t\tclassPath = loc.split('/')[1].split('.js?')[0];\n\t\t\t\t\tconsole.log('Apps')\n\t\t\t\t\tmessage.request.res.setHeader(\"Content-Type\", 'text/javascript' );\n_debug( 'compiling', classPath);\n\t\t\t\t\ttry{\n_debug( 'getting Code from file system');\n\t\t\t\t\t\tvar code = Code();\n\t\t\t\t\t}catch (error){\n_debug( 'src/Code.js could not be read:\\n'+ error.message);\n\t\t\t\t\t\tmessage.request.res.statusCode = 500;\n\t\t\t\t\t\tmessage.request.res.write( '{ \"error\" : \"src/Code.js could not be read:\\n'+ error.message+'}' );\n\t\t\t\t    }\n\t\t\t\t\tvar app;\n\t\t\t\t\tvar bin = 'bin/'+classPath;\n\t\t\t\t\ttry{\n_debug( 'compiling', classPath , 'from source files' );\n\t\t\t\t\t\t\tapp =  Code.c( classPath );\n\t\t\t        } catch ( error ) {//try\n_debug( classPath + ' could not be compiled:\\n'+ error.message);\n\t\t\t        \tmessage.request.res.statusCode = 500;\n\t\t\t        \tmessage.request.res.write( '{ \"error\" : \"'+classPath + ' could not be compiled:\\n'+ error.message+\"}\" );\n\t\t\t\t\t}\n_debug( 'creating exec statement');\n\t\t\t\t\tvar exec = \t'var scripts = document.getElementsByTagName( \"script\" );\\n'+\n\t\t\t\t\t\t\t\t'var script = scripts[ scripts.length - 1 ];\\n'+\n\t\t\t\t\t\t\t\t'var query = script.src.split(\"?\")[1];\\n'+\n\t\t\t\t\t\t\t\t'var settings = {};\\n'+\n\t\t\t\t\t\t\t\t'var list = query.split( \"&\");\\n'+\n\t\t\t\t\t\t\t\t'for (var i in list){\\n'+\n\t\t\t\t\t\t\t\t\t'var pair = list[i].split(\"=\");\\n'+\n\t\t\t\t\t\t\t\t\t'settings[pair[0]] = pair[1];\\n'+\n\t\t\t\t\t\t\t\t' };\\n'+\n\t\t\t\t\t\t\t\t'settings.parent = script.parentNode;\\n'+\n\t\t\t\t\t\t\t\t'Code.x(\"' + classPath + '\",settings);';\n\t\t\t        if( app && code && exec ) {\n\t\t\t        \tmessage.request.res.statusCode = 200;\n_debug( 'adding code:', code.length, 'bytes');\n\t\t\t\t\t\tmessage.request.res.write( code );\n_debug( 'adding app:', app.length, 'bytes');\n\t\t\t\t\t\tmessage.request.res.write( app );\t\t\n_debug( 'adding exec:', exec );\n\n\t\t\t\t\t\tmessage.request.res.end( exec );\n\t\t\t        }//if\n\t\t\t\t}// if\n\t\t\t}// if message.request\n\t\t\tthis._super().process( message );\n\t\t}//,process\n\t})//class\n)//package\n\t"]],"start1":0,"start2":0,"length1":0,"length2":2516}]],"length":2516}
{"contributors":[],"silentsave":false,"ts":1357160391319,"patch":[[{"diffs":[[0," );\n"],[-1,"\t\t\tvar fs = require( 'fs');\n\t\t\tvar path = require( 'path');\n"],[0,"\t\t\ti"]],"start1":288,"start2":288,"length1":68,"length2":8},{"diffs":[[0,", true )"],[1,";"],[0,"\n\t\t\t\tvar"]],"start1":369,"start2":369,"length1":16,"length2":17},{"diffs":[[0,"('Apps')"],[1,";"],[0,"\n\t\t\t\t\tme"]],"start1":605,"start2":605,"length1":16,"length2":17},{"diffs":[[0,"sPath);\n"],[1,"                    var code;\n"],[0,"\t\t\t\t\ttry"]],"start1":712,"start2":712,"length1":16,"length2":46},{"diffs":[[0,";\n\t\t\t\t\t\t"],[-1,"var "],[0,"code = C"]],"start1":800,"start2":800,"length1":20,"length2":16},{"diffs":[[0,"\t\t    }\n"],[1,""],[0,"\t\t\t\t\tvar"]],"start1":1053,"start2":1053,"length1":16,"length2":16},{"diffs":[[0,"pp;\n"],[-1,"\t\t\t\t\tvar bin = 'bin/'+classPath;\n"],[0,"\t\t\t\t"]],"start1":1071,"start2":1071,"length1":41,"length2":8},{"diffs":[[0,"/class\n)"],[1,";"],[0,"//packag"]],"start1":2432,"start2":2432,"length1":16,"length2":17}]],"length":2452,"saved":false}
