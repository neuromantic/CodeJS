{"ts":1357160215132,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"/*!\n *\n * Apps.js\n * com.neuromantic.arete.Apps\n *\n */\n_package( 'com.neuromantic.arete.server',\n \t_import( 'com.neuromantic.arete.component.Component' ),\n\t_class( 'Apps' )._extends( 'Component', {\n\t\tApps : function( ) {\n\t\t},\n\t\tprocess : function ( message ) {\n\t\t\tvar url = require( 'url' );\n\t\t\tvar fs = require( 'fs');\n\t\t\tvar path = require( 'path');\n\t\t\tif( message.request ) {\n\t\t\t\tvar route = url.parse( message.request.req.url, true )\n\t\t\t\tvar loc = route.path;\n\t\t\t\tif( loc.indexOf('/') === 0 ){\n\t\t\t\t\tloc = loc.substring(1);\n\t\t\t\t}//if\n\t\t\t\tvar classPath;\n\t\t\t\tif ( loc.indexOf( 'app' ) === 0 ){\n\t\t\t\t\tclassPath = loc.split('/')[1].split('.js?')[0];\n\t\t\t\t\tconsole.log('Apps')\n\t\t\t\t\tmessage.request.res.setHeader(\"Content-Type\", 'text/javascript' );\n_debug( 'compiling', classPath);\n\t\t\t\t\ttry{\n_debug( 'getting Code from file system');\n\t\t\t\t\t\tvar code = Code();\n\t\t\t\t\t}catch (error){\n_debug( 'src/Code.js could not be read:\\n'+ error.message);\n\t\t\t\t\t\tmessage.request.res.statusCode = 500;\n\t\t\t\t\t\tmessage.request.res.write( '{ \"error\" : \"src/Code.js could not be read:\\n'+ error.message+'}' );\n\t\t\t\t    }\n\t\t\t\t\tvar app;\n\t\t\t\t\tvar bin = 'bin/'+classPath;\n\t\t\t\t\ttry{\n_debug( 'compiling', classPath , 'from source files' );\n\t\t\t\t\t\t\tapp =  Code.c( classPath );\n\t\t\t        } catch ( error ) {//try\n_debug( classPath + ' could not be compiled:\\n'+ error.message);\n\t\t\t        \tmessage.request.res.statusCode = 500;\n\t\t\t        \tmessage.request.res.write( '{ \"error\" : \"'+classPath + ' could not be compiled:\\n'+ error.message+\"}\" );\n\t\t\t\t\t}\n_debug( 'creating exec statement');\n\t\t\t\t\tvar exec = \t'var scripts = document.getElementsByTagName( \"script\" );\\n'+\n\t\t\t\t\t\t\t\t'var script = scripts[ scripts.length - 1 ];\\n'+\n\t\t\t\t\t\t\t\t'var query = script.src.split(\"?\")[1];\\n'+\n\t\t\t\t\t\t\t\t'var settings = {};\\n'+\n\t\t\t\t\t\t\t\t'var list = query.split( \"&\");\\n'+\n\t\t\t\t\t\t\t\t'for (var i in list){\\n'+\n\t\t\t\t\t\t\t\t\t'var pair = list[i].split(\"=\");\\n'+\n\t\t\t\t\t\t\t\t\t'settings[pair[0]] = pair[1];\\n'+\n\t\t\t\t\t\t\t\t' };\\n'+\n\t\t\t\t\t\t\t\t'settings.parent = script.parentNode;\\n'+\n\t\t\t\t\t\t\t\t'Code.x(\"' + classPath + '\",settings);';\n\t\t\t        if( app && code && exec ) {\n\t\t\t        \tmessage.request.res.statusCode = 200;\n_debug( 'adding code:', code.length, 'bytes');\n\t\t\t\t\t\tmessage.request.res.write( code );\n_debug( 'adding app:', app.length, 'bytes');\n\t\t\t\t\t\tmessage.request.res.write( app );\t\t\n_debug( 'adding exec:', exec );\n\n\t\t\t\t\t\tmessage.request.res.end( exec );\n\t\t\t        }//if\n\t\t\t\t}// if\n\t\t\t}// if message.request\n\t\t\tthis._super().process( message );\n\t\t}//,process\n\t})//class\n)//package\n\t"]],"start1":0,"start2":0,"length1":0,"length2":2516}]],"length":2516}
{"contributors":[],"silentsave":false,"ts":1357160391319,"patch":[[{"diffs":[[0," );\n"],[-1,"\t\t\tvar fs = require( 'fs');\n\t\t\tvar path = require( 'path');\n"],[0,"\t\t\ti"]],"start1":288,"start2":288,"length1":68,"length2":8},{"diffs":[[0,", true )"],[1,";"],[0,"\n\t\t\t\tvar"]],"start1":369,"start2":369,"length1":16,"length2":17},{"diffs":[[0,"('Apps')"],[1,";"],[0,"\n\t\t\t\t\tme"]],"start1":605,"start2":605,"length1":16,"length2":17},{"diffs":[[0,"sPath);\n"],[1,"                    var code;\n"],[0,"\t\t\t\t\ttry"]],"start1":712,"start2":712,"length1":16,"length2":46},{"diffs":[[0,";\n\t\t\t\t\t\t"],[-1,"var "],[0,"code = C"]],"start1":800,"start2":800,"length1":20,"length2":16},{"diffs":[[0,"\t\t    }\n"],[1,""],[0,"\t\t\t\t\tvar"]],"start1":1053,"start2":1053,"length1":16,"length2":16},{"diffs":[[0,"pp;\n"],[-1,"\t\t\t\t\tvar bin = 'bin/'+classPath;\n"],[0,"\t\t\t\t"]],"start1":1071,"start2":1071,"length1":41,"length2":8},{"diffs":[[0,"/class\n)"],[1,";"],[0,"//packag"]],"start1":2432,"start2":2432,"length1":16,"length2":17}]],"length":2452,"saved":false}
{"contributors":[],"silentsave":false,"ts":1357500610269,"patch":[[{"diffs":[[0,"        "],[1,"}else{\n_debug( 'incomplete app, not sending.');\n    \t\t        \tmessage.request.res.statusCode = 404;\n    \t\t\t\t\tmessage.request.res.end( 'App ' + classPath + 'not found.' );\n                    "],[0,"}//if\n\t\t"]],"start1":2326,"start2":2326,"length1":16,"length2":208}]],"length":2644,"saved":false}
{"ts":1357500677742,"patch":[[{"diffs":[[0,"Path + '"],[1," "],[0,"not foun"]],"start1":2483,"start2":2483,"length1":16,"length2":17}]],"length":2645,"saved":false}
{"contributors":[],"silentsave":false,"ts":1357504979405,"patch":[[{"diffs":[[0,"exec );\n"],[-1,"\n"],[0,"\t\t\t\t\t\tme"]],"start1":2275,"start2":2275,"length1":17,"length2":16},{"diffs":[[0,"ending.'"],[1,", code.length, app.length, exec.length"],[0,");\n    \t"]],"start1":2370,"start2":2370,"length1":16,"length2":54}]],"length":2682,"saved":false}
{"ts":1357505070877,"patch":[[{"diffs":[[0,".', "],[-1,"code.length, app.length, exec.length"],[1,"typeof code, typeof app, typeof exec"],[0,");\n "]],"start1":2376,"start2":2376,"length1":44,"length2":44}]],"length":2682,"saved":false}
{"contributors":[],"silentsave":false,"ts":1357505363166,"patch":[[{"diffs":[[0,"ing Code"],[1,".js"],[0," from fi"]],"start1":773,"start2":773,"length1":16,"length2":19},{"diffs":[[0,"'adding "],[-1,"c"],[1,"C"],[0,"ode"],[1,".js"],[0,":', code"]],"start1":2087,"start2":2087,"length1":20,"length2":23},{"diffs":[[0,"'adding "],[-1,"a"],[1,"A"],[0,"pp:', ap"]],"start1":2178,"start2":2178,"length1":17,"length2":17},{"diffs":[[0,"pp );\t\t\n"],[-1,""],[0,"_debug( "]],"start1":2249,"start2":2249,"length1":16,"length2":16},{"diffs":[[0,"ing exec"],[1," statement"],[0,":', exec"]],"start1":2269,"start2":2269,"length1":16,"length2":26}]],"length":2698,"saved":false}
{"contributors":[],"silentsave":false,"ts":1357591342413,"patch":[[{"diffs":[[0,"ssage);\n"],[-1,"\t\t\t"],[1,"      "],[0,"        "],[-1,"\t"],[1,"          "],[0,"message."]],"start1":1272,"start2":1272,"length1":28,"length2":40},{"diffs":[[0," = 500;\n"],[-1,"\t\t\t"],[1,"      "],[0,"        "],[-1,"\t"],[1,"          "],[0,"message."]],"start1":1334,"start2":1334,"length1":28,"length2":40},{"diffs":[[0,";';\n"],[-1,"\t\t\t        if( app && code && exec ) {\n\t\t\t        \tmessage.request.res.statusCode = 200;\n_debug( 'adding Code.js:', code.length, 'bytes');\n\t\t\t\t\t\tmessage.request.res.write( code );\n_debug( 'adding App:', app.length, 'bytes');\n\t\t\t\t\t\tmessage.request.res.write( app );\t\t\n_debug( 'adding exec statement:', exec"],[1,"_debug( 'Code.js:', code.length, 'bytes');\n_debug( 'App:', app.length, 'bytes');\n_debug( 'exec statement:', exec );\n\t\t\t        if( app && code && exec ) {\n\t\t\t        \tmessage.request.res.statusCode = 200;\n\t\t\t\t\t\tmessage.request.res.write( code );\n\t\t\t\t\t\tmessage.request.res.write( app"],[0," );\n"]],"start1":2010,"start2":2010,"length1":313,"length2":290},{"diffs":[[0,"  }else{"],[1,"//if"],[0,"\n_debug("]],"start1":2348,"start2":2348,"length1":16,"length2":20},{"diffs":[[0,".', "],[-1,"typeof code"],[1,"code.length"],[0,", ty"]],"start1":2397,"start2":2397,"length1":19,"length2":19},{"diffs":[[0,"c);\n    "],[-1,"\t\t"],[1,"            "],[0,"        "],[-1,"\t"],[0,"message."]],"start1":2436,"start2":2436,"length1":27,"length2":36},{"diffs":[[0,"04;\n    "],[-1,"\t\t\t\t\t"],[1,"                    "],[0,"message."]],"start1":2498,"start2":2498,"length1":21,"length2":36},{"diffs":[[0,"     }//"],[-1,"if"],[1,"else"],[0,"\n\t\t\t\t}//"]],"start1":2604,"start2":2604,"length1":18,"length2":20}]],"length":2729,"saved":false}
