{"ts":1357160215132,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"/*!\n *\n * Apps.js\n * com.neuromantic.arete.Apps\n *\n */\n_package( 'com.neuromantic.arete.server',\n \t_import( 'com.neuromantic.arete.component.Component' ),\n\t_class( 'Apps' )._extends( 'Component', {\n\t\tApps : function( ) {\n\t\t},\n\t\tprocess : function ( message ) {\n\t\t\tvar url = require( 'url' );\n\t\t\tvar fs = require( 'fs');\n\t\t\tvar path = require( 'path');\n\t\t\tif( message.request ) {\n\t\t\t\tvar route = url.parse( message.request.req.url, true )\n\t\t\t\tvar loc = route.path;\n\t\t\t\tif( loc.indexOf('/') === 0 ){\n\t\t\t\t\tloc = loc.substring(1);\n\t\t\t\t}//if\n\t\t\t\tvar classPath;\n\t\t\t\tif ( loc.indexOf( 'app' ) === 0 ){\n\t\t\t\t\tclassPath = loc.split('/')[1].split('.js?')[0];\n\t\t\t\t\tconsole.log('Apps')\n\t\t\t\t\tmessage.request.res.setHeader(\"Content-Type\", 'text/javascript' );\n_debug( 'compiling', classPath);\n\t\t\t\t\ttry{\n_debug( 'getting Code from file system');\n\t\t\t\t\t\tvar code = Code();\n\t\t\t\t\t}catch (error){\n_debug( 'src/Code.js could not be read:\\n'+ error.message);\n\t\t\t\t\t\tmessage.request.res.statusCode = 500;\n\t\t\t\t\t\tmessage.request.res.write( '{ \"error\" : \"src/Code.js could not be read:\\n'+ error.message+'}' );\n\t\t\t\t    }\n\t\t\t\t\tvar app;\n\t\t\t\t\tvar bin = 'bin/'+classPath;\n\t\t\t\t\ttry{\n_debug( 'compiling', classPath , 'from source files' );\n\t\t\t\t\t\t\tapp =  Code.c( classPath );\n\t\t\t        } catch ( error ) {//try\n_debug( classPath + ' could not be compiled:\\n'+ error.message);\n\t\t\t        \tmessage.request.res.statusCode = 500;\n\t\t\t        \tmessage.request.res.write( '{ \"error\" : \"'+classPath + ' could not be compiled:\\n'+ error.message+\"}\" );\n\t\t\t\t\t}\n_debug( 'creating exec statement');\n\t\t\t\t\tvar exec = \t'var scripts = document.getElementsByTagName( \"script\" );\\n'+\n\t\t\t\t\t\t\t\t'var script = scripts[ scripts.length - 1 ];\\n'+\n\t\t\t\t\t\t\t\t'var query = script.src.split(\"?\")[1];\\n'+\n\t\t\t\t\t\t\t\t'var settings = {};\\n'+\n\t\t\t\t\t\t\t\t'var list = query.split( \"&\");\\n'+\n\t\t\t\t\t\t\t\t'for (var i in list){\\n'+\n\t\t\t\t\t\t\t\t\t'var pair = list[i].split(\"=\");\\n'+\n\t\t\t\t\t\t\t\t\t'settings[pair[0]] = pair[1];\\n'+\n\t\t\t\t\t\t\t\t' };\\n'+\n\t\t\t\t\t\t\t\t'settings.parent = script.parentNode;\\n'+\n\t\t\t\t\t\t\t\t'Code.x(\"' + classPath + '\",settings);';\n\t\t\t        if( app && code && exec ) {\n\t\t\t        \tmessage.request.res.statusCode = 200;\n_debug( 'adding code:', code.length, 'bytes');\n\t\t\t\t\t\tmessage.request.res.write( code );\n_debug( 'adding app:', app.length, 'bytes');\n\t\t\t\t\t\tmessage.request.res.write( app );\t\t\n_debug( 'adding exec:', exec );\n\n\t\t\t\t\t\tmessage.request.res.end( exec );\n\t\t\t        }//if\n\t\t\t\t}// if\n\t\t\t}// if message.request\n\t\t\tthis._super().process( message );\n\t\t}//,process\n\t})//class\n)//package\n\t"]],"start1":0,"start2":0,"length1":0,"length2":2516}]],"length":2516}
{"contributors":[],"silentsave":false,"ts":1357160391319,"patch":[[{"diffs":[[0," );\n"],[-1,"\t\t\tvar fs = require( 'fs');\n\t\t\tvar path = require( 'path');\n"],[0,"\t\t\ti"]],"start1":288,"start2":288,"length1":68,"length2":8},{"diffs":[[0,", true )"],[1,";"],[0,"\n\t\t\t\tvar"]],"start1":369,"start2":369,"length1":16,"length2":17},{"diffs":[[0,"('Apps')"],[1,";"],[0,"\n\t\t\t\t\tme"]],"start1":605,"start2":605,"length1":16,"length2":17},{"diffs":[[0,"sPath);\n"],[1,"                    var code;\n"],[0,"\t\t\t\t\ttry"]],"start1":712,"start2":712,"length1":16,"length2":46},{"diffs":[[0,";\n\t\t\t\t\t\t"],[-1,"var "],[0,"code = C"]],"start1":800,"start2":800,"length1":20,"length2":16},{"diffs":[[0,"\t\t    }\n"],[1,""],[0,"\t\t\t\t\tvar"]],"start1":1053,"start2":1053,"length1":16,"length2":16},{"diffs":[[0,"pp;\n"],[-1,"\t\t\t\t\tvar bin = 'bin/'+classPath;\n"],[0,"\t\t\t\t"]],"start1":1071,"start2":1071,"length1":41,"length2":8},{"diffs":[[0,"/class\n)"],[1,";"],[0,"//packag"]],"start1":2432,"start2":2432,"length1":16,"length2":17}]],"length":2452,"saved":false}
{"contributors":[],"silentsave":false,"ts":1357500610269,"patch":[[{"diffs":[[0,"        "],[1,"}else{\n_debug( 'incomplete app, not sending.');\n    \t\t        \tmessage.request.res.statusCode = 404;\n    \t\t\t\t\tmessage.request.res.end( 'App ' + classPath + 'not found.' );\n                    "],[0,"}//if\n\t\t"]],"start1":2326,"start2":2326,"length1":16,"length2":208}]],"length":2644,"saved":false}
{"ts":1357500677742,"patch":[[{"diffs":[[0,"Path + '"],[1," "],[0,"not foun"]],"start1":2483,"start2":2483,"length1":16,"length2":17}]],"length":2645,"saved":false}
{"contributors":[],"silentsave":false,"ts":1357504979405,"patch":[[{"diffs":[[0,"exec );\n"],[-1,"\n"],[0,"\t\t\t\t\t\tme"]],"start1":2275,"start2":2275,"length1":17,"length2":16},{"diffs":[[0,"ending.'"],[1,", code.length, app.length, exec.length"],[0,");\n    \t"]],"start1":2370,"start2":2370,"length1":16,"length2":54}]],"length":2682,"saved":false}
{"ts":1357505070877,"patch":[[{"diffs":[[0,".', "],[-1,"code.length, app.length, exec.length"],[1,"typeof code, typeof app, typeof exec"],[0,");\n "]],"start1":2376,"start2":2376,"length1":44,"length2":44}]],"length":2682,"saved":false}
{"contributors":[],"silentsave":false,"ts":1357505363166,"patch":[[{"diffs":[[0,"ing Code"],[1,".js"],[0," from fi"]],"start1":773,"start2":773,"length1":16,"length2":19},{"diffs":[[0,"'adding "],[-1,"c"],[1,"C"],[0,"ode"],[1,".js"],[0,":', code"]],"start1":2087,"start2":2087,"length1":20,"length2":23},{"diffs":[[0,"'adding "],[-1,"a"],[1,"A"],[0,"pp:', ap"]],"start1":2178,"start2":2178,"length1":17,"length2":17},{"diffs":[[0,"pp );\t\t\n"],[-1,""],[0,"_debug( "]],"start1":2249,"start2":2249,"length1":16,"length2":16},{"diffs":[[0,"ing exec"],[1," statement"],[0,":', exec"]],"start1":2269,"start2":2269,"length1":16,"length2":26}]],"length":2698,"saved":false}
{"contributors":[],"silentsave":false,"ts":1357591342413,"patch":[[{"diffs":[[0,"ssage);\n"],[-1,"\t\t\t"],[1,"      "],[0,"        "],[-1,"\t"],[1,"          "],[0,"message."]],"start1":1272,"start2":1272,"length1":28,"length2":40},{"diffs":[[0," = 500;\n"],[-1,"\t\t\t"],[1,"      "],[0,"        "],[-1,"\t"],[1,"          "],[0,"message."]],"start1":1334,"start2":1334,"length1":28,"length2":40},{"diffs":[[0,";';\n"],[-1,"\t\t\t        if( app && code && exec ) {\n\t\t\t        \tmessage.request.res.statusCode = 200;\n_debug( 'adding Code.js:', code.length, 'bytes');\n\t\t\t\t\t\tmessage.request.res.write( code );\n_debug( 'adding App:', app.length, 'bytes');\n\t\t\t\t\t\tmessage.request.res.write( app );\t\t\n_debug( 'adding exec statement:', exec"],[1,"_debug( 'Code.js:', code.length, 'bytes');\n_debug( 'App:', app.length, 'bytes');\n_debug( 'exec statement:', exec );\n\t\t\t        if( app && code && exec ) {\n\t\t\t        \tmessage.request.res.statusCode = 200;\n\t\t\t\t\t\tmessage.request.res.write( code );\n\t\t\t\t\t\tmessage.request.res.write( app"],[0," );\n"]],"start1":2010,"start2":2010,"length1":313,"length2":290},{"diffs":[[0,"  }else{"],[1,"//if"],[0,"\n_debug("]],"start1":2348,"start2":2348,"length1":16,"length2":20},{"diffs":[[0,".', "],[-1,"typeof code"],[1,"code.length"],[0,", ty"]],"start1":2397,"start2":2397,"length1":19,"length2":19},{"diffs":[[0,"c);\n    "],[-1,"\t\t"],[1,"            "],[0,"        "],[-1,"\t"],[0,"message."]],"start1":2436,"start2":2436,"length1":27,"length2":36},{"diffs":[[0,"04;\n    "],[-1,"\t\t\t\t\t"],[1,"                    "],[0,"message."]],"start1":2498,"start2":2498,"length1":21,"length2":36},{"diffs":[[0,"     }//"],[-1,"if"],[1,"else"],[0,"\n\t\t\t\t}//"]],"start1":2604,"start2":2604,"length1":18,"length2":20}]],"length":2729,"saved":false}
{"contributors":[],"silentsave":false,"ts":1357768140394,"patch":[[{"diffs":[[0,"pt' );\n_"],[-1,"debug"],[1,"verbose"],[0,"( 'compi"]],"start1":680,"start2":680,"length1":21,"length2":23},{"diffs":[[0,"\t\ttry{\n_"],[-1,"debug"],[1,"verbose"],[0,"( 'getti"]],"start1":755,"start2":755,"length1":21,"length2":23},{"diffs":[[0,"rror){\n_"],[-1,"debug"],[1,"verbose"],[0,"( 'src/C"]],"start1":844,"start2":844,"length1":21,"length2":23},{"diffs":[[0,"\t\ttry{\n_"],[-1,"debug"],[1,"verbose"],[0,"( 'compi"]],"start1":1087,"start2":1087,"length1":21,"length2":23},{"diffs":[[0,"{//try\n_"],[-1,"debug"],[1,"verbose"],[0,"( classP"]],"start1":1216,"start2":1216,"length1":21,"length2":23},{"diffs":[[0,"\t\t\t\t\t}\n_"],[-1,"debug"],[1,"verbose"],[0,"( 'creat"]],"start1":1481,"start2":1481,"length1":21,"length2":23},{"diffs":[[0,"gs);';\n_"],[-1,"debug"],[1,"verbose"],[0,"( 'Code."]],"start1":2019,"start2":2019,"length1":21,"length2":23},{"diffs":[[0,"tes');\n_"],[-1,"debug"],[1,"verbose"],[0,"( 'App:'"]],"start1":2064,"start2":2064,"length1":21,"length2":23},{"diffs":[[0,"tes');\n_"],[-1,"debug"],[1,"verbose"],[0,"( 'exec "]],"start1":2104,"start2":2104,"length1":21,"length2":23},{"diffs":[[0,"if\n_"],[-1,"debug"],[1,"verbose"],[0,"( 'i"]],"start1":2376,"start2":2376,"length1":13,"length2":15}]],"length":2749,"saved":false}
{"ts":1357768381568,"patch":[[{"diffs":[[0,"rver',\n "],[-1,"\t"],[1,"   "],[0,"_import("]],"start1":90,"start2":90,"length1":17,"length2":19},{"diffs":[[0,"lassPath"],[1," "],[0,");\n     "]],"start1":713,"start2":713,"length1":16,"length2":17},{"diffs":[[0," system'"],[1," "],[0,");\n\t\t\t\t\t"]],"start1":801,"start2":801,"length1":16,"length2":17},{"diffs":[[0,".length, 'bytes'"],[1," "],[0,");\n_verbose( 'Ap"]],"start1":2056,"start2":2056,"length1":32,"length2":33},{"diffs":[[0," 'bytes'"],[1," "],[0,");\n_verb"]],"start1":2105,"start2":2105,"length1":16,"length2":17},{"diffs":[[0,"ment:', exec"],[-1," "],[1,".bytes, 'bytes'"],[0,");\n\t\t\t      "]],"start1":2138,"start2":2138,"length1":25,"length2":39}]],"length":2769,"saved":false}
{"contributors":[],"silentsave":false,"ts":1357774308366,"patch":[[{"diffs":[[0,"exec = \t"],[1,"'( function (){\\n'+\n                                "],[0,"'var scr"]],"start1":1539,"start2":1539,"length1":16,"length2":68},{"diffs":[[0,"ttings);"],[1,"\\n'+\n                                '})();"],[0,"';\n_verb"]],"start1":2071,"start2":2071,"length1":16,"length2":59}]],"length":2864,"saved":false}
{"contributors":[],"silentsave":false,"ts":1358281206304,"patch":[[{"diffs":[[0,"0];\n"],[-1,"\t\t\t\t\tconsole.log('Apps');\n"],[0,"\t\t\t\t"]],"start1":587,"start2":587,"length1":34,"length2":8}]],"length":2838,"saved":false}
{"ts":1358283474838,"patch":[[{"diffs":[[0,"})();';\n"],[1,"_verbose( '***');\n"],[0,"_verbose"]],"start1":2091,"start2":2091,"length1":16,"length2":34}]],"length":2856,"saved":false}
{"ts":1358283561174,"patch":[[{"diffs":[[0,"var app;"],[1,"\n\n_verbose( '***');"],[0,"\n\t\t\t\t\ttr"]],"start1":1053,"start2":1053,"length1":16,"length2":35},{"diffs":[[0,"\n\t\t\t\t\t}\n"],[1,"_verbose( '***');\n"],[0,"_verbose"]],"start1":1477,"start2":1477,"length1":16,"length2":34},{"diffs":[[0,"})();';\n"],[-1,"_verbose( '***');\n"],[0,"_verbose"]],"start1":2128,"start2":2128,"length1":34,"length2":16}]],"length":2875,"saved":false}
{"ts":1358288124489,"patch":[[{"diffs":[[0,"app;"],[-1,"\n\n_verbose( '***');"],[0,"\n\t\t\t"]],"start1":1057,"start2":1057,"length1":27,"length2":8},{"diffs":[[0,"\t\t}\n"],[-1,"_verbose( '***');\n"],[0,"_ver"]],"start1":1462,"start2":1462,"length1":26,"length2":8},{"diffs":[[0,"e{//if\n_"],[-1,"v"],[0,"er"],[-1,"bose"],[1,"ror"],[0,"( 'incom"]],"start1":2461,"start2":2461,"length1":23,"length2":21}]],"length":2836,"saved":false}
{"ts":1358288137104,"patch":[[{"diffs":[[0,"ng.'"],[-1,", code.length, typeof app, typeof exec"],[0,");\n "]],"start1":2502,"start2":2502,"length1":46,"length2":8}]],"length":2798,"saved":false}
{"ts":1358288192461,"patch":[[{"diffs":[[0,"xec ) {\n"],[1,"_debug( 'sending app to client');\n"],[0,"\t\t\t     "]],"start1":2268,"start2":2268,"length1":16,"length2":50}]],"length":2832,"saved":false}
{"ts":1358288369632,"patch":[[{"diffs":[[0,")();';\n_"],[-1,"verbose"],[1,"debug"],[0,"( 'Code."]],"start1":2092,"start2":2092,"length1":23,"length2":21},{"diffs":[[0,"es' );\n_"],[-1,"verbose"],[1,"debug"],[0,"( 'App:'"]],"start1":2136,"start2":2136,"length1":23,"length2":21},{"diffs":[[0,"es' );\n_"],[-1,"verbose"],[1,"debug"],[0,"( 'exec "]],"start1":2175,"start2":2175,"length1":23,"length2":21}]],"length":2826,"saved":false}
{"ts":1358288413557,"patch":[[{"diffs":[[0,"', exec."],[-1,"bytes"],[1,"length"],[0,", 'bytes"]],"start1":2206,"start2":2206,"length1":21,"length2":22}]],"length":2827,"saved":false}
{"ts":1358288527694,"patch":[[{"diffs":[[0,"\t\ttry{\n_"],[-1,"verbose"],[1,"debug"],[0,"( 'getti"]],"start1":732,"start2":732,"length1":23,"length2":21}]],"length":2825,"saved":false}
{"ts":1358288646477,"patch":[[{"diffs":[[0,"rror){\n_"],[-1,"v"],[0,"er"],[-1,"bose"],[1,"ror"],[0,"( 'src/C"]],"start1":820,"start2":820,"length1":23,"length2":21}]],"length":2823,"saved":false}
{"ts":1358289025485,"patch":[[{"diffs":[[0,"Code();\n"],[1,"_debug( ':::', code.length, 'bytes');\n"],[0,"\t\t\t\t\t}ca"]],"start1":798,"start2":798,"length1":16,"length2":54}]],"length":2861,"saved":false}
{"contributors":[],"silentsave":false,"ts":1358665477741,"patch":[[{"diffs":[[0,"c.arete."],[1,"server."],[0,"Apps\n *\n"]],"start1":35,"start2":35,"length1":16,"length2":23},{"diffs":[[0,"pt' );\n_"],[-1,"verbose"],[1,"debug"],[0,"( 'compi"]],"start1":663,"start2":663,"length1":23,"length2":21},{"diffs":[[0,"{//try\n_"],[-1,"v"],[0,"er"],[-1,"bose"],[1,"ror"],[0,"( classP"]],"start1":1233,"start2":1233,"length1":23,"length2":21}]],"length":2864,"saved":false}
{"contributors":[],"silentsave":false,"ts":1360609517645,"patch":[[{"diffs":[[0,"();\n"],[-1,"_debug( ':::', code.length, 'bytes');\n"],[0,"\t\t\t\t"]],"start1":807,"start2":807,"length1":46,"length2":8}]],"length":2826,"saved":false}
{"contributors":[],"silentsave":false,"ts":1361317776508,"patch":[[{"diffs":[[0,"r i "],[-1,"in list"],[1,"= 0; i < list.length; i++ "],[0,"){\\n"]],"start1":1833,"start2":1833,"length1":15,"length2":34}]],"length":2845,"saved":false}
{"contributors":[],"silentsave":false,"ts":1361492614389,"patch":[[{"diffs":[[0,"route.path;\n"],[1,"                console.log( 'LOC', loc );\n"],[0,"\t\t\t\tif( loc."]],"start1":402,"start2":402,"length1":24,"length2":67}]],"length":2888,"saved":false}
{"ts":1361492710563,"patch":[[{"diffs":[[0,"g( '"],[-1,"LOC', loc"],[1,"APP index', loc.indexOf( 'app' )"],[0," );\n"]],"start1":440,"start2":440,"length1":17,"length2":40}]],"length":2911,"saved":false}
{"contributors":[],"silentsave":false,"ts":1361574403432,"patch":[[{"diffs":[[0," 'app' ) );\n"],[1,"                var pathArray = loc.split( '/' );\n"],[0,"\t\t\t\tif( loc."]],"start1":468,"start2":468,"length1":24,"length2":74},{"diffs":[[0,"f ( "],[-1,"loc.indexOf("],[1,"pathArray[1] =="],[0," 'app' )"],[-1," === 0"],[0," ){\n"]],"start1":627,"start2":627,"length1":34,"length2":31},{"diffs":[[0,"h = "],[-1,"loc.split('/')[1"],[1,"pathArray[2"],[0,"].sp"]],"start1":671,"start2":671,"length1":24,"length2":19}]],"length":2953,"saved":false}
{"ts":1361574458263,"patch":[[{"diffs":[[0,"== 'app'"],[-1," )"],[0," ){\n\t\t\t\t"]],"start1":644,"start2":644,"length1":18,"length2":16}]],"length":2951,"saved":false}
{"contributors":[],"silentsave":false,"ts":1361588126182,"patch":[[{"diffs":[[0,"lit( '/' );\n"],[1,"\n"],[0,"\t\t\t\tif( loc."]],"start1":518,"start2":518,"length1":24,"length2":25},{"diffs":[[0,"== 'app' ){\n"],[1,"_debug( 'app requested')\n"],[0,"\t\t\t\t\tclassPa"]],"start1":645,"start2":645,"length1":24,"length2":49}]],"length":2977,"saved":false}
{"ts":1361589178373,"patch":[[{"diffs":[[0,"?')[0];\n"],[1,"_debug( 'compiling', classPath );\n"],[0,"\t\t\t\t\tmes"]],"start1":722,"start2":722,"length1":16,"length2":50},{"diffs":[[0," );\n"],[-1,"_debug( 'compiling', classPath );\n"],[0,"    "]],"start1":832,"start2":832,"length1":42,"length2":8}]],"length":2977,"saved":false}
{"ts":1361596400673,"patch":[[{"diffs":[[0,"\t\t\t}"],[-1,"// if\n\t\t\t}// if message.request\n\t\t\t"],[1,"else{// if app    \n                    "],[0,"this"]],"start1":2866,"start2":2866,"length1":43,"length2":47},{"diffs":[[0,"sage );\n"],[1,"\t\t\t\t}\n\t\t\t}// if message.request\n"],[0,"\t\t}//,pr"]],"start1":2935,"start2":2935,"length1":16,"length2":48}]],"length":3013,"saved":false}
{"contributors":[],"silentsave":false,"ts":1362178170634,"patch":[[{"diffs":[[0,"ascript' );\n"],[1,"                    var init = '( function (){\\n';\n"],[0,"            "]],"start1":824,"start2":824,"length1":24,"length2":75},{"diffs":[[0,"r code;\n"],[-1,""],[0,"\t\t\t\t\ttry"]],"start1":909,"start2":909,"length1":16,"length2":16},{"diffs":[[0," = \t"],[-1,"'( function (){\\n'+\n                                "],[0,"'var"]],"start1":1699,"start2":1699,"length1":60,"length2":8},{"diffs":[[0,"})();';\n"],[1,"_debug( 'init statement:', init.length, 'bytes' );\n"],[0,"_debug( "]],"start1":2240,"start2":2240,"length1":16,"length2":67},{"diffs":[[0,"     if("],[1," init &&"],[0," app && "]],"start1":2438,"start2":2438,"length1":16,"length2":24},{"diffs":[[0,"Code = 200;\n"],[-1,"\t"],[1,"    \t\t\t\t\tmessage.request.res.write( init );\n    "],[0,"\t\t\t\t\tmessage"]],"start1":2551,"start2":2551,"length1":25,"length2":72},{"diffs":[[0,"e = "],[-1,"404"],[1,"500"],[0,";\n  "]],"start1":2846,"start2":2846,"length1":11,"length2":11},{"diffs":[[0,"s.end( '"],[-1,"App"],[1,"Error "],[0," ' + cla"]],"start1":2897,"start2":2897,"length1":19,"length2":22}]],"length":3121,"saved":false}
