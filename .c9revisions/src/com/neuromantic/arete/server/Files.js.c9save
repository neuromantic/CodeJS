{"ts":1357318101469,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"/*!\n *\n * Files.js\n * com.neuromantic.arete.server.Files\n *\n */\n_package( 'com.neuromantic.arete.server',\n \t_import( 'com.neuromantic.arete.component.Component' ),\n\t_class( 'Files' )._extends( 'Component', {\n\t\tprivate_root: '/',\n\t\tprivate_types: { \n\t\t\thtml : 'text/html',\n\t\t\tjs: 'text/javascript',\n\t\t\ttxt: 'text/plain',\n\t\t\tcss: 'text/css',\n\t\t\tjpeg: 'image/jpeg',\n\t\t\tjpg: 'image/jpeg',\n\t\t\tpng: 'image/png',\n\t\t\tico: 'image/vnd.microsoft.icon'\n\t\t},\n\t\tconfig: function ( config ){\n\t\t\tif( config.files ){\n\t\t\t\tvar config = config.files;\n\t\t\t\tif ( config.root ){\n\t\t\t\t\tthis._.root = config.root;\n\t\t\t\t}\n\t\t\t\tif ( config.types ) {\n\t\t\t\t\tthis._.types = config.types;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tprocess : function ( message ){\n\t\t\tif( message.request ) {\n\t\t\t\tvar request = message.request;\n\t\t\t\tvar path = require( 'url' ).parse( request.req.url ).path;\n\t\t\t\tvar root = this._.root\n\t\t\t\tif( root.indexOf('/') === 0 ){\n\t\t\t\t\troot = root.substring(1);\n\t\t\t\t}\n\t\t\t\tvar file = path.substring( path.lastIndexOf( '/' ) + 1 );\n\t\t\t\tif (file == ''){\n\t\t\t\t\tfile = 'index.html';\n\t\t\t\t\tpath+=file;\n\t\t\t\t}\n\t\t\t\tvar ext = file.substring( file.lastIndexOf( '.' ) + 1 );\n\t\t\t\tvar type = this._.types[ ext ];\n\t\t\t\tif( type ) {\n\t\t\t\t\trequest.res.setHeader(\"Content-Type\", type );\n\t\t\t\t\ttry{\n\t\t\t\t\t\tvar filePath = root + path;\n\t\t\t       \t\tvar buffer = fs.readFileSync( filePath );\n\t\t\t\t        if( buffer ) {\n\t\t\t\t\t        if( type.indexOf ( 'text' ) >= 0 ){\n\t\t\t\t\t               buffer = buffer.toString();\n\t\t\t\t\t        }\n\t\t\t\t\t\t\trequest.res.statusCode = 200;\n\t\t\t\t\t\t\trequest.res.end( buffer );\n\t\t\t\t    \t}\n\t\t\t        } catch ( error ) {\n\t\t\t        \trequest.res.statusCode = 404;\n\t\t\t        \trequest.res.end( error.message );\n\t\t\t        }\n\t\t\t\t}\n\t\t\t}\t\t\t\n\t\t\tthis._super().process( message );\n\t\t}//,\n\t})\n);"]],"start1":0,"start2":0,"length1":0,"length2":1739}]],"length":1739}
{"contributors":[],"silentsave":false,"ts":1357318415454,"patch":[[{"diffs":[[0,"n'\n\t\t},\n"],[1,"        Files : function ( settings ) {\n            this._super( {files: settings });\n        },\n"],[0,"\t\tconfig"]],"start1":438,"start2":438,"length1":16,"length2":113}]],"length":1836,"saved":false}
{"contributors":[],"silentsave":false,"ts":1357320659097,"patch":[[{"diffs":[[0,"th;\n"],[-1,"\t\t\t"],[1,"      "],[0,"       "],[-1,"\t\t"],[1,"           "],[0,"var "]],"start1":1361,"start2":1361,"length1":20,"length2":32},{"diffs":[[0,"filePath );\n"],[-1,"\t\t\t\t"],[1,"                "],[0,"        if( "]],"start1":1419,"start2":1419,"length1":28,"length2":40},{"diffs":[[0,"fer ) {\n"],[-1,"\t\t\t\t\t"],[1,"                    "],[0,"        "]],"start1":1462,"start2":1462,"length1":21,"length2":36},{"diffs":[[0,">= 0 ){\n"],[-1,"\t\t\t\t\t"],[1,"       "],[0,"        "]],"start1":1526,"start2":1526,"length1":21,"length2":23},{"diffs":[[0,"        "],[1,"          "],[0,"buffer ="]],"start1":1548,"start2":1548,"length1":16,"length2":26},{"diffs":[[0,"ring();\n"],[-1,"\t\t\t\t\t"],[1,"                    "],[0,"        "]],"start1":1586,"start2":1586,"length1":21,"length2":36},{"diffs":[[0," );\n"],[-1,"\t\t\t\t"],[1,"                    "],[0,"    "],[-1,"\t"],[0,"}\n"],[-1,"\t\t\t"],[1,"            "],[0,"    "]],"start1":1691,"start2":1691,"length1":22,"length2":46},{"diffs":[[0,"ror ) {\n"],[-1,"\t\t\t"],[0,"        "],[-1,"\t"],[1,"                "],[0,"request."]],"start1":1753,"start2":1753,"length1":28,"length2":40},{"diffs":[[0,"04;\n"],[-1,"\t\t\t"],[1,"     "],[0,"        "],[-1,"\t"],[1,"           "],[0,"requ"]],"start1":1811,"start2":1811,"length1":20,"length2":32},{"diffs":[[0,"sage );\n"],[-1,"\t\t\t"],[1,"            "],[0,"        "]],"start1":1865,"start2":1865,"length1":19,"length2":28}]],"length":1959,"saved":false}
{"ts":1357332089533,"patch":[[{"diffs":[[0,"                "],[1,"//"],[0,"request.res.stat"]],"start1":1769,"start2":1769,"length1":32,"length2":34},{"diffs":[[0,"        "],[1,"//"],[0,"request."]],"start1":1833,"start2":1833,"length1":16,"length2":18}]],"length":1963,"saved":false}
{"ts":1357332133596,"patch":[[{"diffs":[[0,"(file =="],[1,"="],[0," ''){\n\t\t"]],"start1":1093,"start2":1093,"length1":16,"length2":17}]],"length":1964,"saved":false}
{"ts":1357335255685,"patch":[[{"diffs":[[0,") {\n"],[-1,"\t\t\t\t\trequest.res.setHeader(\"Content-Type\", type );\n"],[0,"\t\t\t\t"]],"start1":1267,"start2":1267,"length1":59,"length2":8},{"diffs":[[0,"          }\n"],[1,"                            request.res.setHeader(\"Content-Type\", type );\n"],[0,"\t\t\t\t\t\t\treque"]],"start1":1562,"start2":1562,"length1":24,"length2":98}]],"length":1987,"saved":false}
{"ts":1357335688104,"patch":[[{"diffs":[[0,"s._.root"],[1,";"],[0,"\n\t\t\t\tif("]],"start1":943,"start2":943,"length1":16,"length2":17},{"diffs":[[0,"+ path;\n"],[1,"                        var fs = require('fs');\n"],[0,"        "]],"start1":1308,"start2":1308,"length1":16,"length2":64}]],"length":2036,"saved":false}
{"contributors":[],"silentsave":false,"ts":1357423511833,"patch":[[{"diffs":[[0," ){\n\t\t\t\t"],[-1,"var "],[0,"config ="]],"start1":593,"start2":593,"length1":20,"length2":16},{"diffs":[[0,"( error ) {\n"],[1,"                        _debug( 'error :'. error );\n"],[0,"            "]],"start1":1818,"start2":1818,"length1":24,"length2":76}]],"length":2084,"saved":false}
{"contributors":[],"silentsave":false,"ts":1358288266707,"patch":[[{"diffs":[[0,") {\n"],[-1,"                        _debug( '"],[1,"_"],[0,"error"],[-1," :'."],[1,"("],[0," err"]],"start1":1826,"start2":1826,"length1":50,"length2":15}]],"length":2049,"saved":false}
{"ts":1358288282967,"patch":[[{"diffs":[[0,"                "],[-1,"//"],[0,"request.res.stat"]],"start1":1855,"start2":1855,"length1":34,"length2":32},{"diffs":[[0,"        "],[-1,"//"],[0,"request."]],"start1":1917,"start2":1917,"length1":18,"length2":16}]],"length":2045,"saved":false}
{"contributors":[],"silentsave":false,"ts":1364071486541,"patch":[[{"diffs":[[0,"e = 200;\n\t\t\t\t\t\t\t"],[1,"return "],[0,"request.res.end("]],"start1":1721,"start2":1721,"length1":32,"length2":39}]],"length":2052,"saved":false}
{"ts":1364071580349,"patch":[[{"diffs":[[0,"request "],[1,"&& ! message.res.statusCode"],[0,") {\n\t\t\t\t"]],"start1":811,"start2":811,"length1":16,"length2":43},{"diffs":[[0,"\t\t\t\t"],[-1,"return "],[0,"requ"]],"start1":1760,"start2":1760,"length1":15,"length2":8}]],"length":2072,"saved":false}
{"ts":1364071603372,"patch":[[{"diffs":[[0,"message."],[1,"request."],[0,"res.stat"]],"start1":824,"start2":824,"length1":16,"length2":24}]],"length":2080,"saved":false}
{"ts":1364071719727,"patch":[[{"diffs":[[0,"Code) {\n\t\t\t\t"],[1,"_debug( 'new request with no statuscode')\n                "],[0,"var request "]],"start1":850,"start2":850,"length1":24,"length2":82}]],"length":2138,"saved":false}
{"ts":1364071806205,"patch":[[{"diffs":[[0," ){\n"],[-1,"\t\t\tif( message.request && !"],[1,"    \t\t\t_debug('Files:', require( 'url' ).parse( request.req.url ).path;,"],[0," mes"]],"start1":792,"start2":792,"length1":35,"length2":80},{"diffs":[[0,"Code"],[-1,") {"],[1," );"],[0,"\n\t\t\t"],[-1,"\t_debug( 'new request with no statuscode')"],[1,"if( message.request ) {"],[0,"\n   "]],"start1":895,"start2":895,"length1":57,"length2":38}]],"length":2164,"saved":false}
{"ts":1364071835332,"patch":[[{"diffs":[[0," 'url' ).parse( "],[1,"message."],[0,"request.req.url "]],"start1":828,"start2":828,"length1":32,"length2":40},{"diffs":[[0,"l ).path"],[-1,";"],[0,", messag"]],"start1":866,"start2":866,"length1":17,"length2":16}]],"length":2171,"saved":false}
{"ts":1364072261299,"patch":[[{"diffs":[[0," ){\n"],[-1,"    \t\t\t_debug('Files:', require( 'url' ).parse( message.request.req.url ).path, message.request.res.statusCode );\n"],[0,"\t\t\ti"]],"start1":792,"start2":792,"length1":122,"length2":8},{"diffs":[[0,") {\n"],[-1,"\t\t\t\t\ttry{\n\t"],[0,"\t\t\t\t"]],"start1":1276,"start2":1276,"length1":19,"length2":8},{"diffs":[[0,"            "],[-1,"    "],[0,"var fs = req"]],"start1":1321,"start2":1321,"length1":28,"length2":24},{"diffs":[[0,"('fs');\n"],[1,"                    if(fs.existsSync( filePath)){\n"],[0,"        "]],"start1":1349,"start2":1349,"length1":16,"length2":66},{"diffs":[[0,"( buffer );\n"],[1,""],[0,"            "]],"start1":1799,"start2":1799,"length1":24,"length2":24},{"diffs":[[0,"  }\n"],[-1,"                    } catch ( error ) {\n_error( error );\n                        request.res.statusCode = 404;\n                        request.res.end( error.message );\n"],[0,"    "]],"start1":1833,"start2":1833,"length1":177,"length2":8}]],"length":1923,"saved":false}
{"contributors":[],"silentsave":false,"ts":1364228205346,"patch":[[{"diffs":[[0,"+ path;\n"],[1,"_debug( 'looking for file of type', type, 'at', filePath);\n"],[0,"        "]],"start1":1305,"start2":1305,"length1":16,"length2":75},{"diffs":[[0,"Path)){\n"],[1,"_debug( 'found', filePath);\n"],[0,"        "]],"start1":1458,"start2":1458,"length1":16,"length2":44},{"diffs":[[0," = 200;\n"],[1,"_debug( 'sending', buffer.length, 'bytes');\n"],[0,"\t\t\t\t\t\t\tr"]],"start1":1856,"start2":1856,"length1":16,"length2":60}]],"length":2054,"saved":false}
{"ts":1364230482735,"patch":[[{"diffs":[[0,"filePath );\n"],[1,"_debug( 'data:', buffer.toString());\n"],[0,"            "]],"start1":1548,"start2":1548,"length1":24,"length2":61}]],"length":2091,"saved":false}
{"contributors":[],"silentsave":false,"ts":1364761655547,"patch":[[{"diffs":[[0," buffer."],[-1,"toString()"],[1,"length, 'bytes'"],[0,");\n     "]],"start1":1576,"start2":1576,"length1":26,"length2":31}]],"length":2096,"saved":false}
