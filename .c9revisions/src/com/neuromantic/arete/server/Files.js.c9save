{"ts":1357318101469,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"/*!\n *\n * Files.js\n * com.neuromantic.arete.server.Files\n *\n */\n_package( 'com.neuromantic.arete.server',\n \t_import( 'com.neuromantic.arete.component.Component' ),\n\t_class( 'Files' )._extends( 'Component', {\n\t\tprivate_root: '/',\n\t\tprivate_types: { \n\t\t\thtml : 'text/html',\n\t\t\tjs: 'text/javascript',\n\t\t\ttxt: 'text/plain',\n\t\t\tcss: 'text/css',\n\t\t\tjpeg: 'image/jpeg',\n\t\t\tjpg: 'image/jpeg',\n\t\t\tpng: 'image/png',\n\t\t\tico: 'image/vnd.microsoft.icon'\n\t\t},\n\t\tconfig: function ( config ){\n\t\t\tif( config.files ){\n\t\t\t\tvar config = config.files;\n\t\t\t\tif ( config.root ){\n\t\t\t\t\tthis._.root = config.root;\n\t\t\t\t}\n\t\t\t\tif ( config.types ) {\n\t\t\t\t\tthis._.types = config.types;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tprocess : function ( message ){\n\t\t\tif( message.request ) {\n\t\t\t\tvar request = message.request;\n\t\t\t\tvar path = require( 'url' ).parse( request.req.url ).path;\n\t\t\t\tvar root = this._.root\n\t\t\t\tif( root.indexOf('/') === 0 ){\n\t\t\t\t\troot = root.substring(1);\n\t\t\t\t}\n\t\t\t\tvar file = path.substring( path.lastIndexOf( '/' ) + 1 );\n\t\t\t\tif (file == ''){\n\t\t\t\t\tfile = 'index.html';\n\t\t\t\t\tpath+=file;\n\t\t\t\t}\n\t\t\t\tvar ext = file.substring( file.lastIndexOf( '.' ) + 1 );\n\t\t\t\tvar type = this._.types[ ext ];\n\t\t\t\tif( type ) {\n\t\t\t\t\trequest.res.setHeader(\"Content-Type\", type );\n\t\t\t\t\ttry{\n\t\t\t\t\t\tvar filePath = root + path;\n\t\t\t       \t\tvar buffer = fs.readFileSync( filePath );\n\t\t\t\t        if( buffer ) {\n\t\t\t\t\t        if( type.indexOf ( 'text' ) >= 0 ){\n\t\t\t\t\t               buffer = buffer.toString();\n\t\t\t\t\t        }\n\t\t\t\t\t\t\trequest.res.statusCode = 200;\n\t\t\t\t\t\t\trequest.res.end( buffer );\n\t\t\t\t    \t}\n\t\t\t        } catch ( error ) {\n\t\t\t        \trequest.res.statusCode = 404;\n\t\t\t        \trequest.res.end( error.message );\n\t\t\t        }\n\t\t\t\t}\n\t\t\t}\t\t\t\n\t\t\tthis._super().process( message );\n\t\t}//,\n\t})\n);"]],"start1":0,"start2":0,"length1":0,"length2":1739}]],"length":1739}
{"contributors":[],"silentsave":false,"ts":1357318415454,"patch":[[{"diffs":[[0,"n'\n\t\t},\n"],[1,"        Files : function ( settings ) {\n            this._super( {files: settings });\n        },\n"],[0,"\t\tconfig"]],"start1":438,"start2":438,"length1":16,"length2":113}]],"length":1836,"saved":false}
{"contributors":[],"silentsave":false,"ts":1357320659097,"patch":[[{"diffs":[[0,"th;\n"],[-1,"\t\t\t"],[1,"      "],[0,"       "],[-1,"\t\t"],[1,"           "],[0,"var "]],"start1":1361,"start2":1361,"length1":20,"length2":32},{"diffs":[[0,"filePath );\n"],[-1,"\t\t\t\t"],[1,"                "],[0,"        if( "]],"start1":1419,"start2":1419,"length1":28,"length2":40},{"diffs":[[0,"fer ) {\n"],[-1,"\t\t\t\t\t"],[1,"                    "],[0,"        "]],"start1":1462,"start2":1462,"length1":21,"length2":36},{"diffs":[[0,">= 0 ){\n"],[-1,"\t\t\t\t\t"],[1,"       "],[0,"        "]],"start1":1526,"start2":1526,"length1":21,"length2":23},{"diffs":[[0,"        "],[1,"          "],[0,"buffer ="]],"start1":1548,"start2":1548,"length1":16,"length2":26},{"diffs":[[0,"ring();\n"],[-1,"\t\t\t\t\t"],[1,"                    "],[0,"        "]],"start1":1586,"start2":1586,"length1":21,"length2":36},{"diffs":[[0," );\n"],[-1,"\t\t\t\t"],[1,"                    "],[0,"    "],[-1,"\t"],[0,"}\n"],[-1,"\t\t\t"],[1,"            "],[0,"    "]],"start1":1691,"start2":1691,"length1":22,"length2":46},{"diffs":[[0,"ror ) {\n"],[-1,"\t\t\t"],[0,"        "],[-1,"\t"],[1,"                "],[0,"request."]],"start1":1753,"start2":1753,"length1":28,"length2":40},{"diffs":[[0,"04;\n"],[-1,"\t\t\t"],[1,"     "],[0,"        "],[-1,"\t"],[1,"           "],[0,"requ"]],"start1":1811,"start2":1811,"length1":20,"length2":32},{"diffs":[[0,"sage );\n"],[-1,"\t\t\t"],[1,"            "],[0,"        "]],"start1":1865,"start2":1865,"length1":19,"length2":28}]],"length":1959,"saved":false}
{"ts":1357332089533,"patch":[[{"diffs":[[0,"                "],[1,"//"],[0,"request.res.stat"]],"start1":1769,"start2":1769,"length1":32,"length2":34},{"diffs":[[0,"        "],[1,"//"],[0,"request."]],"start1":1833,"start2":1833,"length1":16,"length2":18}]],"length":1963,"saved":false}
{"ts":1357332133596,"patch":[[{"diffs":[[0,"(file =="],[1,"="],[0," ''){\n\t\t"]],"start1":1093,"start2":1093,"length1":16,"length2":17}]],"length":1964,"saved":false}
{"ts":1357335255685,"patch":[[{"diffs":[[0,") {\n"],[-1,"\t\t\t\t\trequest.res.setHeader(\"Content-Type\", type );\n"],[0,"\t\t\t\t"]],"start1":1267,"start2":1267,"length1":59,"length2":8},{"diffs":[[0,"          }\n"],[1,"                            request.res.setHeader(\"Content-Type\", type );\n"],[0,"\t\t\t\t\t\t\treque"]],"start1":1562,"start2":1562,"length1":24,"length2":98}]],"length":1987,"saved":false}
{"ts":1357335688104,"patch":[[{"diffs":[[0,"s._.root"],[1,";"],[0,"\n\t\t\t\tif("]],"start1":943,"start2":943,"length1":16,"length2":17},{"diffs":[[0,"+ path;\n"],[1,"                        var fs = require('fs');\n"],[0,"        "]],"start1":1308,"start2":1308,"length1":16,"length2":64}]],"length":2036,"saved":false}
{"contributors":[],"silentsave":false,"ts":1357423511833,"patch":[[{"diffs":[[0," ){\n\t\t\t\t"],[-1,"var "],[0,"config ="]],"start1":593,"start2":593,"length1":20,"length2":16},{"diffs":[[0,"( error ) {\n"],[1,"                        _debug( 'error :'. error );\n"],[0,"            "]],"start1":1818,"start2":1818,"length1":24,"length2":76}]],"length":2084,"saved":false}
